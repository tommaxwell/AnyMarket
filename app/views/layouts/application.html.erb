<!DOCTYPE html>
<html lang="en">
<head meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AnyMarket</title>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag :defaults %>
  <%= csrf_meta_tags %>
</head>
<body>
<% if signed_in?(:user) %>
  <div id="listing-new">
   <h3 id="list-header">List an item for sale</h3>
  <i><p style="color:#bbb">One man's trash is another man's treasure.</p></i>
  <%= form_for Product.new, :options => {:id => "new_listing"}, :url => {:controller => "products",:action => "create"}, :html => {:multipart => true} do |f| %>
    <%= f.text_field :name, :id => "name_input", :autofocus => true, :required => true, :placeholder => "Item name", :class => "form_inputs" %><br /><%= f.number_field :decimal_price, :step => 'any', :id => "price", :required => true, :placeholder => "Name your price", :class => "form_inputs" %>
  <div>
    <%= f.text_area :description, :cols => "40", :rows => "8", :maxlength => 250, :id => "description", :required => true, :placeholder => "Write a few sentences about the item you're listing. Is it in good condition? Are there any accessories included?", :class => "form_inputs" %>
    <%= f.text_area :about_delivery, :cols => "40", :rows => "8", :maxlength => 250, :id => "about_delivery", :required => true, :placeholder => "What times of the week are you available to meet? Where around campus would be the best place? You can discuss in further detail with the buyer once your item is sold.", :class => "form_inputs" %>
  </div>
  <div>
    <%= f.label "Add a photo (increases your likelihood of selling)" %><br />
    <%= f.file_field :photo %>
  </div>
  <br />
  <div>
    <%= f.label "Category" %><br />
    <%= f.collection_select :category_id, Category.all, :id, :name, {:prompt => 'Choose a category'}, {:required => true} %>
  </div><br />
    <% if !current_user.braintree_customer_id? %>
    <%= f.submit "List!", :id => "submit", :disabled => true, :id => "submit_item_btn" %><br /><br />
    <i>Woops, looks like you haven't added your credit/debit card. Click <a href="/customer/new">here</a>.</i>
    <% else %>
    <%= f.submit "List!", :id => "submit",:id => "submit_item_btn" %>
    <% end %>
<% end %>
</div>
<div class="container-fluid">
  <div id="fixed-navbar">
    <a href="/"><h3 id="site-header">AnyMarket</h3></a><p id="tagline">safe, secure, verified selling</p>
    <ul id="nav-links">
      <li><a id="list-item-btn">List an Item</a></li>
      <li><%= link_to "Settings", edit_user_registration_path, :method => :get %></li>
      <li><a href="/users/<%= current_user.id %>"><%= image_tag current_user.avatar.url(:thumb), :id => "profile_picture", :width => "30", :height => "30" %></a></li>
      <li><%= link_to "Sign out", destroy_user_session_path, :method => :delete %></li>
    </ul>
  </div>
  <% if !current_user.braintree_customer_id? %>
  <%= render "/layouts/no_cc_alert" unless @skip_alert %>
  <% else %>
  <% end %>
<% else %>
  
  <div id="fixed-navbar">
    <h2>CollegeCommerce</h2>
    <ul id="nav-links">
      <li><%= link_to "Log In", new_user_session_path, :method => :get %></li>
      <li><%= link_to "Sign Up", new_user_registration_path, :method => :get %></li>
    </ul>
  </div>
  
<% end %>
  
<% if notice %>
  <p class="alert alert-success"><%= notice %></p>
<% end %>
<% if alert %>
  <p class="alert alert-danger"><%= alert %></p>
<% end %>
<%= yield %>
  </div>
<%= javascript_include_tag "application" %>
<script type="text/javascript">

    
  $("#listing-new").hide();
  $("#past-listings").hide();

$(document).on('click',function(e){
    if (!$('#listing-new').is(e.target) && $('#listing-new').has(e.target).length === 0 && !$('#list-item-btn').is(e.target) && $('#list-item-btn').has(e.target).length === 0){
        $("#listing-new").hide();
        $(".container-fluid").css("opacity","1");
        }
    else{
        $("#listing-new").fadeIn("fast");
        $(".container-fluid").css("opacity","0.3");
        }
});
  
  $("#listings-toggle").click(function(){
    $("#current-listings, #past-listings").toggle().toggleClass("active");
  })
</script>
</body>
</html>