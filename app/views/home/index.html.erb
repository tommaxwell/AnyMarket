<% if signed_in?(:user) %>
<% @title="AnyMarket - Home" %>
<div id="categories-page-wrapper" class="index_categories">
  <h4>Explore Listings</h4>
  <% @categories.each do |f| %>
    <p class="category-page-category"><%= link_to f.name, view_category_path(f.id) %></p>
  <% end %>
	
</div>
<div id="index-wrapper">
	<div id="featured">
		<h3 id="your-listings-header" class="page-header"><span class="glyphicon glyphicon-star"></span>FEATURED <a href="#" data-toggle="tooltip" data-placement="right" title="Listings featured by the AnyMarket team" id="tool"><span class="glyphicon glyphicon-question-sign"></span></a></h3>
		<% featured = Product.order('created_at DESC').limit(6).where.not(photo_file_name: nil, sold_value: true) %>
		<% featured.each do |f| %>
		<a href="/products/<%= f.id %>"><%= image_tag Product.find(f.id).photo.url(:medium).sub('http://s3.amazonaws.com/anymarket/','http://anymarket.s3.amazonaws.com/'), :class => "featured_product" %></a>
		<% end %>
	</div> 
	<div id="your-listings">
		<h3 id="your-listings-header" class="page-header"><span class="glyphicon glyphicon-usd"></span>WHAT YOU'RE SELLING <a href="#" data-toggle="tooltip" data-placement="right" title="Listings you've added" id="tool"><span class="glyphicon glyphicon-question-sign"></span></a></h3>
		<% notsold = @user.products.where("sold_value = false").order("created_at DESC") %>
		<% if notsold.any? %>
		<% i = 0 %>
		<% notsold.each do |f| %>
			<% i += 1 %>
			<div class="listing">
				<h4 class="counter"><%= i %>.</h4><%= link_to view_item_path(f.id), :method => "get" do  %><h4><%= f.name %></h4><% end %><% if f.photo? %><span id="camera-icon-preview" class="glyphicon glyphicon-camera preview_toggle" data-id="<%= f.id %>"></span><% else %><% end %><p><%= truncate(f.description, :length => 60) %></p> <strong><p class="price"><%= number_to_currency(f.decimal_price, precision: 2) %></p></strong>
			</div>
			<% end %>
		</div>
		<% else %>
		<div id="list-first-wrapper"><a href="/products/new"><span class="glyphicon glyphicon-plus"></span><h3>Have something to sell? Let's list it!</h3></a></div>
		<% end %>
		<div id="most-recent">
			<% recentlistings = Product.order('created_at DESC').limit(5).where.not(user_id: current_user.id, sold_value: true) %>
		<h3 id="your-listings-header" class="page-header"><span class="glyphicon glyphicon-time"></span>RECENTLY ADDED IN YOUR NETWORK <a href="#" data-toggle="tooltip" data-placement="right" title="Listings recently added at your school" id="tools"><span class="glyphicon glyphicon-question-sign"></span></a></h3>
		<% recentlistings.each do |f| %>
			<div class="listing">
							<a href="/users/<%= f.user_id %>" class="nounderline"><%= image_tag User.find(f.user_id).avatar.url(:thumb).sub('http://s3.amazonaws.com/anymarket/','http://anymarket.s3.amazonaws.com/'), :id => "categories_profile_picture", :width => "30", :height => "30" %></a><h4><%= link_to f.name, view_item_path(f.id) %></h4><% if f.photo? %><span id="camera-icon-preview" class="glyphicon glyphicon-camera preview_toggle" data-id="<%= f.id %>"></span><% else %><% end %><p><%= truncate(f.description, :length => 60) %></p><strong><p class="price"><%= number_to_currency(f.decimal_price, precision: 2) %></p></strong>
						</div>
		<% end %>
	</div>
</div>
	<% else %>
	<% @title="AnyMarket - Quick, easy, verified selling at your school." %>
	<div id="landing-wrapper">
		<div id="sign_up_and_pitch">
			<h3 id="pitch">Quick, easy,<br /> verified selling at your school.</h3>
			<p id="available-at">*Currently available at University of California, Berkeley</p>
			<%= form_for User.new, :options => {:id => "new_listing"}, :url => {:controller => "registrations",:action => "create"} do |f| %>
			<div id="first-last-name">
			<%= f.text_field :first_name, :id => "name_input", :autofocus => true, :required => true, :placeholder => "First name", :class => "form_inputs" %>
			<%= f.text_field :last_name, :id => "name_input", :required => true, :placeholder => "Last name", :class => "form_inputs" %>
			</div>
			<%= f.text_field :email, :id => "name_input", :required => true, :placeholder => "@berkeley.edu", :class => "form_inputs" %><br />
			<%= f.password_field :password, :id => "name_input", :required => true, :placeholder => "Password (minimum 8 characters)", :class => "form_inputs" %><br />
			<%= f.submit "Join AnyMarket", :id => "submit",:id => "submit_item_btn" %>
			<% end %>
			<p>AnyMarket is the safe, simple solution to buying & selling locally. Only deal with other students at your school, verified through their .edu email address. All money is held in escrow — backed by our partner at Braintree Payments, the leader in payment processing — until you meet and make the exchange. No dealing with strangers, no finding an ATM to get cash out. Simple. 
</p>
		</div>
		<div id="recently_added_preview">
			<div id="landing-recent">
			<% recentlistings = Product.order('created_at DESC').limit(5).where("sold_value = false") %>
			<h3 id="your-listings-header" class="page-header">Recently Added Items</h3>
			<% recentlistings.each do |f| %>
				<% @user = User.find(f.user_id) %>
				<div class="listing">
								<a href="/users/<%= f.user_id %>" class="nounderline">
										<span class="user-image-as-background" size="30" style="background-image: url(<%=  @user.avatar.url(:medium).sub('http://s3.amazonaws.com/anymarket/','http://anymarket.s3.amazonaws.com/')%>); width: 30px; height: 30px"></span>
					</a><h4><%= link_to f.name, view_item_path(f.id) %></h4><strong><p class="price"><%= number_to_currency(f.decimal_price, precision: 2) %></p></strong>
							</div>
			<% end %>
			</div>
		</div>
	<% end %>
</div>